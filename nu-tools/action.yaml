name: 'Nu Tools Setup'
description: 'Sets up modular Nushell tools for release workflows'
author: 'ck3mp3r'

inputs: {}

runs:
  using: 'composite'
  steps:
    - name: Install Nix
      uses: DeterminateSystems/nix-installer-action@v20

    - name: Setup Nushell via Nix
      shell: bash
      run: |
        echo "Installing Nushell via nix..."
        # Always install latest from nixpkgs since version pinning in nix is more complex
        # and would require specific nixpkgs revisions
        nix profile install nixpkgs#nushell
        
        # Verify installation
        nu --version

    - name: Install Nu Tools Modules
      shell: bash
      run: |
        # Create nushell lib directory and copy modules there
        mkdir -p ~/.local/share/nushell/nu-tools
        cp ${{ github.action_path }}/modules/*.nu ~/.local/share/nushell/nu-tools/
        
        # Set NU_LIB_DIRS environment variable for current and future steps
        echo "NU_LIB_DIRS=$HOME/.local/share/nushell" >> $GITHUB_ENV

    - name: Verify Installation
      shell: bash
      run: |
        echo "Verifying Nu Tools installation..."
        echo "NU_LIB_DIRS: $NU_LIB_DIRS"
        ls -la ~/.local/share/nushell/nu-tools/
        nu -c 'print "Nushell is working"'
        nu -c 'use nu-tools *; print "Nu Tools modules loaded successfully"'

branding:
  icon: 'package'
  color: 'blue'